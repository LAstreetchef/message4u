/**
 * SecretMessage4U Widget
 * Embeddable white-label widget for secret message creation
 * 
 * @version 1.0.0
 * @license MIT
 */
!function(){"use strict";const e="https://secretmessage4u.com",n={mode:"inline",target:"#secret-message-widget",trigger:null,theme:{accent:"#7c5cfc",background:"#ffffff",textColor:"#1a1a2e",radius:12,title:"Send a Secret Message",subtitle:"Only the recipient can unlock it",btnText:"Send Secret Message",footer:""},pricing:{defaultPrice:2.99,allowCustomPrice:!1,minPrice:.99,maxPrice:99.99}};function t(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}function s(e){return"$"+parseFloat(e).toFixed(2)}function r(){return"sm-"+Math.random().toString(36).substr(2,9)}const i={async getPartnerConfig(n){const t=await fetch(`${e}/v1/partners/${n}/widget-config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){if(404===t.status)throw new Error("Partner not found");throw new Error("Failed to load widget configuration")}return t.json()},async createMessage(n){const t=await fetch(`${e}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){const e=await t.json().catch(()=>({}));if(429===t.status)throw new Error("Please wait a moment before sending another message.");throw new Error(e.message||"Failed to send message")}return t.json()}};class o{constructor(e){this.config={...n,...e},this.partnerId=e.partnerId,this.mode=e.mode||"inline",this.target=e.target,this.trigger=e.trigger,this.callbacks=e.callbacks||{},this.partnerConfig=null,this.root=null,this.shadowRoot=null,this.isLoading=!1,this.isSubmitting=!1,this.isSuccess=!1,this.successData=null,this.init()}async init(){try{if(this.createContainer(),this.renderLoading(),this.partnerConfig=await i.getPartnerConfig(this.partnerId),"active"!==this.partnerConfig.status)return void this.renderDisabled();this.mergeConfig(),this.render(),"modal"===this.mode&&this.setupModal(),this.callbacks.onReady&&this.callbacks.onReady()}catch(e){console.error("[SM Widget] Init error:",e),this.renderError(e.message),this.callbacks.onError&&this.callbacks.onError({code:"init_error",message:e.message})}}createContainer(){if("inline"===this.mode){const e=document.querySelector(this.target);if(!e)throw new Error(`Target element not found: ${this.target}`);this.root=document.createElement("div"),this.root.id=r(),e.appendChild(this.root)}else this.root=document.createElement("div"),this.root.id=r(),document.body.appendChild(this.root);this.shadowRoot=this.root.attachShadow({mode:"open"});const e=document.createElement("style");e.textContent="\n    :host {\n      --sm-accent: #7c5cfc;\n      --sm-accent-hover: #6b4ce0;\n      --sm-bg: #ffffff;\n      --sm-text: #1a1a2e;\n      --sm-text-dim: #6b6b80;\n      --sm-border: #e1e1e6;\n      --sm-error: #e53e3e;\n      --sm-success: #38a169;\n      --sm-radius: 12px;\n      --sm-font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      \n      display: block;\n      font-family: var(--sm-font);\n      font-size: 16px;\n      line-height: 1.5;\n      color: var(--sm-text);\n    }\n    \n    *, *::before, *::after {\n      box-sizing: border-box;\n    }\n    \n    .sm-widget {\n      background: var(--sm-bg);\n      border-radius: var(--sm-radius);\n      padding: 24px;\n      max-width: 400px;\n      margin: 0 auto;\n    }\n    \n    .sm-widget--modal {\n      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    }\n    \n    .sm-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      margin: 0 0 4px 0;\n      color: var(--sm-text);\n    }\n    \n    .sm-subtitle {\n      font-size: 0.875rem;\n      color: var(--sm-text-dim);\n      margin: 0 0 20px 0;\n    }\n    \n    .sm-form {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n    \n    .sm-field {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    }\n    \n    .sm-label {\n      font-size: 0.875rem;\n      font-weight: 500;\n      color: var(--sm-text);\n    }\n    \n    .sm-textarea {\n      width: 100%;\n      min-height: 100px;\n      max-height: 200px;\n      padding: 12px;\n      border: 1px solid var(--sm-border);\n      border-radius: calc(var(--sm-radius) / 2);\n      font-family: inherit;\n      font-size: 1rem;\n      resize: vertical;\n      transition: border-color 0.2s, box-shadow 0.2s;\n    }\n    \n    .sm-textarea:focus {\n      outline: none;\n      border-color: var(--sm-accent);\n      box-shadow: 0 0 0 3px rgba(124, 92, 252, 0.1);\n    }\n    \n    .sm-textarea::placeholder {\n      color: var(--sm-text-dim);\n    }\n    \n    .sm-input {\n      width: 100%;\n      padding: 12px;\n      border: 1px solid var(--sm-border);\n      border-radius: calc(var(--sm-radius) / 2);\n      font-family: inherit;\n      font-size: 1rem;\n      transition: border-color 0.2s, box-shadow 0.2s;\n    }\n    \n    .sm-input:focus {\n      outline: none;\n      border-color: var(--sm-accent);\n      box-shadow: 0 0 0 3px rgba(124, 92, 252, 0.1);\n    }\n    \n    .sm-input::placeholder {\n      color: var(--sm-text-dim);\n    }\n    \n    .sm-input--error,\n    .sm-textarea--error {\n      border-color: var(--sm-error);\n    }\n    \n    .sm-error-text {\n      font-size: 0.75rem;\n      color: var(--sm-error);\n      margin-top: 4px;\n    }\n    \n    .sm-price-row {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 12px 0;\n      border-top: 1px solid var(--sm-border);\n      border-bottom: 1px solid var(--sm-border);\n    }\n    \n    .sm-price-label {\n      font-size: 0.875rem;\n      color: var(--sm-text-dim);\n    }\n    \n    .sm-price-value {\n      font-size: 1.125rem;\n      font-weight: 600;\n      color: var(--sm-text);\n    }\n    \n    .sm-btn {\n      width: 100%;\n      padding: 14px 24px;\n      background: var(--sm-accent);\n      color: white;\n      border: none;\n      border-radius: calc(var(--sm-radius) / 2);\n      font-family: inherit;\n      font-size: 1rem;\n      font-weight: 600;\n      cursor: pointer;\n      transition: background-color 0.2s, transform 0.1s;\n      min-height: 48px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n    }\n    \n    .sm-btn:hover:not(:disabled) {\n      background: var(--sm-accent-hover);\n    }\n    \n    .sm-btn:active:not(:disabled) {\n      transform: scale(0.98);\n    }\n    \n    .sm-btn:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n    \n    .sm-btn--loading .sm-btn-text {\n      visibility: hidden;\n    }\n    \n    .sm-spinner {\n      position: absolute;\n      width: 20px;\n      height: 20px;\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-top-color: white;\n      border-radius: 50%;\n      animation: sm-spin 0.8s linear infinite;\n    }\n    \n    @keyframes sm-spin {\n      to { transform: rotate(360deg); }\n    }\n    \n    .sm-footer {\n      text-align: center;\n      margin-top: 16px;\n    }\n    \n    .sm-footer-text {\n      font-size: 0.75rem;\n      color: var(--sm-text-dim);\n    }\n    \n    .sm-no-account {\n      font-size: 0.8125rem;\n      color: var(--sm-text-dim);\n      text-align: center;\n      margin-top: 12px;\n    }\n    \n    /* Success State */\n    .sm-success {\n      text-align: center;\n      padding: 20px 0;\n    }\n    \n    .sm-success-icon {\n      width: 64px;\n      height: 64px;\n      background: var(--sm-success);\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin: 0 auto 16px;\n    }\n    \n    .sm-success-icon svg {\n      width: 32px;\n      height: 32px;\n      color: white;\n    }\n    \n    .sm-success-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      margin: 0 0 8px 0;\n    }\n    \n    .sm-success-subtitle {\n      font-size: 0.875rem;\n      color: var(--sm-text-dim);\n      margin: 0 0 20px 0;\n    }\n    \n    .sm-url-box {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px;\n      background: #f5f5f7;\n      border-radius: calc(var(--sm-radius) / 2);\n      margin-bottom: 16px;\n    }\n    \n    .sm-url-text {\n      flex: 1;\n      font-size: 0.875rem;\n      color: var(--sm-text);\n      word-break: break-all;\n      text-align: left;\n    }\n    \n    .sm-copy-btn {\n      padding: 8px;\n      background: transparent;\n      border: none;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: background 0.2s;\n      flex-shrink: 0;\n    }\n    \n    .sm-copy-btn:hover {\n      background: rgba(0, 0, 0, 0.05);\n    }\n    \n    .sm-copy-btn svg {\n      width: 20px;\n      height: 20px;\n      color: var(--sm-text-dim);\n    }\n    \n    .sm-price-note {\n      font-size: 0.875rem;\n      color: var(--sm-text-dim);\n      margin-bottom: 20px;\n    }\n    \n    .sm-btn--secondary {\n      background: transparent;\n      color: var(--sm-accent);\n      border: 1px solid var(--sm-accent);\n    }\n    \n    .sm-btn--secondary:hover:not(:disabled) {\n      background: rgba(124, 92, 252, 0.05);\n    }\n    \n    /* Modal Overlay */\n    .sm-modal-overlay {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      padding: 20px;\n      opacity: 0;\n      visibility: hidden;\n      transition: opacity 0.2s, visibility 0.2s;\n    }\n    \n    .sm-modal-overlay--open {\n      opacity: 1;\n      visibility: visible;\n    }\n    \n    .sm-modal-content {\n      transform: scale(0.95);\n      transition: transform 0.2s;\n    }\n    \n    .sm-modal-overlay--open .sm-modal-content {\n      transform: scale(1);\n    }\n    \n    .sm-modal-close {\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      cursor: pointer;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s;\n    }\n    \n    .sm-modal-close:hover {\n      background: rgba(0, 0, 0, 0.05);\n    }\n    \n    .sm-modal-close svg {\n      width: 20px;\n      height: 20px;\n      color: var(--sm-text-dim);\n    }\n    \n    /* Loading Skeleton */\n    .sm-skeleton {\n      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n      background-size: 200% 100%;\n      animation: sm-shimmer 1.5s infinite;\n      border-radius: 4px;\n    }\n    \n    @keyframes sm-shimmer {\n      0% { background-position: 200% 0; }\n      100% { background-position: -200% 0; }\n    }\n    \n    .sm-skeleton-title {\n      height: 24px;\n      width: 70%;\n      margin-bottom: 8px;\n    }\n    \n    .sm-skeleton-subtitle {\n      height: 16px;\n      width: 50%;\n      margin-bottom: 20px;\n    }\n    \n    .sm-skeleton-textarea {\n      height: 100px;\n      margin-bottom: 16px;\n    }\n    \n    .sm-skeleton-input {\n      height: 48px;\n      margin-bottom: 16px;\n    }\n    \n    .sm-skeleton-btn {\n      height: 48px;\n    }\n    \n    /* Error State */\n    .sm-error-state {\n      text-align: center;\n      padding: 40px 20px;\n    }\n    \n    .sm-error-state-icon {\n      font-size: 48px;\n      margin-bottom: 16px;\n    }\n    \n    .sm-error-state-text {\n      color: var(--sm-text-dim);\n      margin-bottom: 16px;\n    }\n    \n    /* Responsive */\n    @media (max-width: 380px) {\n      .sm-widget {\n        padding: 16px;\n      }\n      \n      .sm-btn {\n        min-height: 52px;\n      }\n    }\n  ",this.shadowRoot.appendChild(e)}mergeConfig(){const e=this.partnerConfig,t=this.config.theme||{};this.theme={accent:this.config.accent||t.accent||e.theme?.accent||n.theme.accent,background:this.config.bg||t.background||e.theme?.background||n.theme.background,textColor:this.config.textColor||t.textColor||e.theme?.text_color||n.theme.textColor,radius:this.config.radius||t.radius||e.theme?.radius||n.theme.radius,title:this.config.title||t.title||e.theme?.title||n.theme.title,subtitle:this.config.subtitle||t.subtitle||e.theme?.subtitle||n.theme.subtitle,btnText:this.config.btnText||t.btnText||e.theme?.btn_text||n.theme.btnText,footer:void 0!==this.config.footer?this.config.footer:t.footer||e.theme?.footer||""},this.pricing={defaultPrice:this.config.price||e.pricing?.default_price||n.pricing.defaultPrice,allowCustomPrice:e.pricing?.allow_custom_price||n.pricing.allowCustomPrice,minPrice:e.pricing?.min_price||n.pricing.minPrice,maxPrice:e.pricing?.max_price||n.pricing.maxPrice}}applyThemeVariables(e){e.style.setProperty("--sm-accent",this.theme.accent),e.style.setProperty("--sm-bg",this.theme.background),e.style.setProperty("--sm-text",this.theme.textColor),e.style.setProperty("--sm-radius",this.theme.radius+"px");const n=this.theme.accent.replace("#",""),t=Math.max(0,parseInt(n.substr(0,2),16)-20),s=Math.max(0,parseInt(n.substr(2,2),16)-20),r=Math.max(0,parseInt(n.substr(4,2),16)-20);e.style.setProperty("--sm-accent-hover",`rgb(${t}, ${s}, ${r})`)}renderLoading(){const e=document.createElement("div");e.className="sm-widget",e.innerHTML='\n        <div class="sm-skeleton sm-skeleton-title"></div>\n        <div class="sm-skeleton sm-skeleton-subtitle"></div>\n        <div class="sm-skeleton sm-skeleton-textarea"></div>\n        <div class="sm-skeleton sm-skeleton-input"></div>\n        <div class="sm-skeleton sm-skeleton-btn"></div>\n      ',this.shadowRoot.appendChild(e)}renderDisabled(){this.clearContent();const e=document.createElement("div");e.className="sm-widget",e.innerHTML='\n        <div class="sm-error-state">\n          <div class="sm-error-state-icon">üîí</div>\n          <p class="sm-error-state-text">This widget is currently unavailable.</p>\n        </div>\n      ',this.applyThemeVariables(e),this.shadowRoot.appendChild(e)}renderError(e){this.clearContent();const n=document.createElement("div");n.className="sm-widget",n.innerHTML=`\n        <div class="sm-error-state">\n          <div class="sm-error-state-icon">‚ö†Ô∏è</div>\n          <p class="sm-error-state-text">${t(e)}</p>\n          <button class="sm-btn sm-btn--secondary" id="sm-retry-btn">Try Again</button>\n        </div>\n      `,this.shadowRoot.appendChild(n),n.querySelector("#sm-retry-btn").addEventListener("click",()=>{this.init()})}clearContent(){Array.from(this.shadowRoot.children).forEach(e=>{"STYLE"!==e.tagName&&e.remove()})}render(){if(this.clearContent(),this.isSuccess)return void this.renderSuccess();const e=document.createElement("div");e.className="sm-widget"+("modal"===this.mode?" sm-widget--modal":""),e.innerHTML=`\n        <h2 class="sm-title">${t(this.theme.title)}</h2>\n        <p class="sm-subtitle">${t(this.theme.subtitle)}</p>\n        \n        <form class="sm-form" id="sm-form">\n          <div class="sm-field">\n            <label class="sm-label" for="sm-message">Your secret message</label>\n            <textarea \n              class="sm-textarea" \n              id="sm-message" \n              name="message"\n              placeholder="Type your secret message..."\n              maxlength="5000"\n              rows="4"\n              required\n              aria-describedby="sm-message-error"\n            ></textarea>\n            <span class="sm-error-text" id="sm-message-error" style="display: none;"></span>\n          </div>\n          \n          <div class="sm-field">\n            <label class="sm-label" for="sm-email">Your email (for receipt)</label>\n            <input \n              type="email" \n              class="sm-input" \n              id="sm-email" \n              name="email"\n              placeholder="your@email.com"\n              aria-describedby="sm-email-error"\n            />\n            <span class="sm-error-text" id="sm-email-error" style="display: none;"></span>\n          </div>\n          \n          <div class="sm-price-row">\n            <span class="sm-price-label">Unlock price</span>\n            <span class="sm-price-value">${s(this.pricing.defaultPrice)}</span>\n          </div>\n          \n          <button type="submit" class="sm-btn" id="sm-submit-btn" aria-busy="false">\n            <span class="sm-btn-text">${t(this.theme.btnText)}</span>\n            <span class="sm-spinner" style="display: none;"></span>\n          </button>\n        </form>\n        \n        <p class="sm-no-account">No account needed</p>\n        ${this.theme.footer?`<div class="sm-footer"><span class="sm-footer-text">${t(this.theme.footer)}</span></div>`:""}\n      `,this.applyThemeVariables(e),this.shadowRoot.appendChild(e),this.setupForm(e)}renderSuccess(){this.clearContent();const e=document.createElement("div");e.className="sm-widget"+("modal"===this.mode?" sm-widget--modal":""),e.innerHTML=`\n        <div class="sm-success">\n          <div class="sm-success-icon">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n              <polyline points="20 6 9 17 4 12"></polyline>\n            </svg>\n          </div>\n          <h2 class="sm-success-title">Message Sent!</h2>\n          <p class="sm-success-subtitle">Share this link with your recipient:</p>\n          \n          <div class="sm-url-box">\n            <span class="sm-url-text" id="sm-unlock-url">${this.successData.unlock_url}</span>\n            <button class="sm-copy-btn" id="sm-copy-btn" title="Copy link">\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n              </svg>\n            </button>\n          </div>\n          \n          <p class="sm-price-note">They'll pay ${s(this.successData.price)} to unlock.</p>\n          \n          <button class="sm-btn sm-btn--secondary" id="sm-send-another">Send Another</button>\n        </div>\n      `,this.applyThemeVariables(e),this.shadowRoot.appendChild(e),e.querySelector("#sm-copy-btn").addEventListener("click",()=>{navigator.clipboard.writeText(this.successData.unlock_url).then(()=>{const n=e.querySelector("#sm-copy-btn");n.innerHTML='\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <polyline points="20 6 9 17 4 12"></polyline>\n            </svg>\n          ',setTimeout(()=>{n.innerHTML='\n              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n              </svg>\n            '},2e3)})}),e.querySelector("#sm-send-another").addEventListener("click",()=>{this.isSuccess=!1,this.successData=null,this.render()})}setupForm(e){const n=e.querySelector("#sm-form"),t=e.querySelector("#sm-message"),s=e.querySelector("#sm-email"),r=e.querySelector("#sm-submit-btn");n.addEventListener("submit",async o=>{if(o.preventDefault(),this.isSubmitting)return;const a=t.value.trim(),l=s.value.trim();let c=!1;if(this.clearFieldError(e,"sm-message"),this.clearFieldError(e,"sm-email"),a||(this.showFieldError(e,"sm-message","Please enter a message"),c=!0),l&&!function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}(l)&&(this.showFieldError(e,"sm-email","Please enter a valid email"),c=!0),!c){this.isSubmitting=!0,r.classList.add("sm-btn--loading"),r.querySelector(".sm-spinner").style.display="block",r.setAttribute("aria-busy","true"),r.disabled=!0;try{const e=await i.createMessage({partner_id:this.partnerId,content:a,sender_email:l||null,price:this.pricing.defaultPrice,currency:"USD",metadata:{}});this.isSuccess=!0,this.successData=e,this.render(),this.callbacks.onMessageCreated&&this.callbacks.onMessageCreated(e)}catch(t){console.error("[SM Widget] Submit error:",t);const s=e.querySelector(".sm-form-error");s&&s.remove();const r=document.createElement("div");r.className="sm-form-error",r.style.cssText="color: var(--sm-error); text-align: center; margin-top: 12px; font-size: 0.875rem;",r.textContent=t.message||"Something went wrong. Please try again.",n.appendChild(r),this.callbacks.onError&&this.callbacks.onError({code:"submit_error",message:t.message})}finally{this.isSubmitting=!1,r.classList.remove("sm-btn--loading"),r.querySelector(".sm-spinner").style.display="none",r.setAttribute("aria-busy","false"),r.disabled=!1}}})}showFieldError(e,n,t){const s=e.querySelector(`#${n}`),r=e.querySelector(`#${n}-error`);s&&s.classList.add("TEXTAREA"===s.tagName?"sm-textarea--error":"sm-input--error"),r&&(r.textContent=t,r.style.display="block")}clearFieldError(e,n){const t=e.querySelector(`#${n}`),s=e.querySelector(`#${n}-error`);t&&t.classList.remove("sm-textarea--error","sm-input--error"),s&&(s.textContent="",s.style.display="none")}setupModal(){this.modalOverlay=document.createElement("div"),this.modalOverlay.className="sm-modal-overlay",this.modalOverlay.innerHTML='\n        <div class="sm-modal-content" style="position: relative;">\n          <button class="sm-modal-close" aria-label="Close">\n            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n      ';const e=this.shadowRoot.querySelector(".sm-widget");if(e&&this.modalOverlay.querySelector(".sm-modal-content").appendChild(e),this.clearContent(),this.shadowRoot.appendChild(this.modalOverlay),this.modalOverlay.querySelector(".sm-modal-close").addEventListener("click",()=>{this.close()}),this.modalOverlay.addEventListener("click",e=>{e.target===this.modalOverlay&&this.close()}),this.escHandler=e=>{"Escape"===e.key&&this.modalOverlay.classList.contains("sm-modal-overlay--open")&&this.close()},document.addEventListener("keydown",this.escHandler),this.trigger){const e=document.querySelector(this.trigger);e&&e.addEventListener("click",()=>{this.open()})}}open(){"modal"===this.mode&&this.modalOverlay&&(this.modalOverlay.classList.add("sm-modal-overlay--open"),document.body.style.overflow="hidden",setTimeout(()=>{const e=this.shadowRoot.querySelector(".sm-textarea, .sm-input");e&&e.focus()},100),this.callbacks.onModalOpen&&this.callbacks.onModalOpen())}close(){"modal"===this.mode&&this.modalOverlay&&(this.modalOverlay.classList.remove("sm-modal-overlay--open"),document.body.style.overflow="",this.callbacks.onModalClose&&this.callbacks.onModalClose())}destroy(){this.escHandler&&document.removeEventListener("keydown",this.escHandler),this.root&&this.root.remove(),this.root=null,this.shadowRoot=null,this.modalOverlay=null}}const a={instances:[],init(e){if(!e.partnerId)return console.error("[SM Widget] partnerId is required"),null;const n=new o(e);return this.instances.push(n),n},destroyAll(){this.instances.forEach(e=>e.destroy()),this.instances=[]}};window.SecretMessageWidget=a,function(){const e=document.currentScript||document.querySelector("script[data-partner-id]");if(!e||!e.dataset.partnerId)return;const n={partnerId:e.dataset.partnerId,mode:e.dataset.mode||"inline",target:e.dataset.target||"#secret-message-widget",trigger:e.dataset.trigger||null,accent:e.dataset.accent,bg:e.dataset.bg,textColor:e.dataset.textColor,radius:e.dataset.radius?parseInt(e.dataset.radius,10):null,title:e.dataset.title,subtitle:e.dataset.subtitle,btnText:e.dataset.btnText,price:e.dataset.price?parseFloat(e.dataset.price):null,footer:e.dataset.footer};Object.keys(n).forEach(e=>{void 0!==n[e]&&null!==n[e]||delete n[e]}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{a.init(n)}):a.init(n)}()}();